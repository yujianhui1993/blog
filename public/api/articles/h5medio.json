{"title":"h5页面调用摄像头","uid":"e2dd80b7de5fb2e3b8f29ae72f511dd3","slug":"h5medio","date":"2023-01-01T10:49:36.000Z","updated":"2023-06-09T01:13:36.593Z","comments":true,"path":"api/articles/h5medio.json","keywords":null,"cover":null,"content":"<h1 id=\"h5页面调用摄像头\"><a href=\"#h5页面调用摄像头\" class=\"headerlink\" title=\"h5页面调用摄像头\"></a>h5页面调用摄像头</h1><h2 id=\"调用摄像头的几个易难点\"><a href=\"#调用摄像头的几个易难点\" class=\"headerlink\" title=\"调用摄像头的几个易难点\"></a>调用摄像头的几个易难点</h2><ol>\n<li>本地可以部署后不行<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p> navigator.mediaDevices 调用需要在 localhost,或者https 的环境下才能成功，如果是http的则将报错，无法调用成功。</p></blockquote>\n</li>\n<li>video 的宽高设置<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>video组件的宽高比是固定的，直接设置宽高是不能达到效果，我们需要 “object-fit: fill”, 将内容填充。这样设置的宽高才有效果。</p></blockquote>\n</li>\n<li>video 呈现的画面镜像问题<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>这个需要翻转 利用 transform: rotateY(180deg)可以实现。</p></blockquote>\n</li>\n<li>ios 无法调用问题<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>网上原有的方案中。在video.onloadedmetadata 方法中去调用 video.play() 可实现调起摄像头（在安卓手机上）。ios在升级后，这种方案已经无法调用了。我们需要调用 video.load() 后，延迟调用video.play() 延迟时间大概一秒左右。（底部有源码）</p></blockquote>\n</li>\n<li>保存图片镜像问题<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>利用canvas 保存video帧动画时，也会出现图片镜像问题，这时我们需要 context.scale(-1, 1) 左右镜像翻转，来实现。</p></blockquote>\n</li>\n</ol>\n<h2 id=\"vue-封装的-h5中调用摄像头代码-使用方法\"><a href=\"#vue-封装的-h5中调用摄像头代码-使用方法\" class=\"headerlink\" title=\"vue 封装的 h5中调用摄像头代码 使用方法\"></a>vue 封装的 h5中调用摄像头代码 使用方法</h2><ol>\n<li><p>引入组件（下方代码）</p>\n</li>\n<li><p>暴露方法 getVideoCameraInfo() 返回 canvas的数据，由自己处理</p>\n</li>\n</ol>\n<h3 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;video</span><br><span class=\"line\">      ref=&quot;video&quot;</span><br><span class=\"line\">      id=&quot;videoCamera&quot;</span><br><span class=\"line\">      autoPlay</span><br><span class=\"line\">      muted</span><br><span class=\"line\">      :width=&quot;videoWidth&quot;</span><br><span class=\"line\">      :height=&quot;videoHeight&quot;</span><br><span class=\"line\">      playsInline&gt;</span><br><span class=\"line\">    &lt;/video&gt;</span><br><span class=\"line\">    &lt;canvas </span><br><span class=\"line\">      style=&quot;display: none&quot;</span><br><span class=\"line\">      :width=&quot;videoWidth&quot;</span><br><span class=\"line\">      :height=&quot;videoHeight&quot;</span><br><span class=\"line\">      id=&quot;canvasCamera&quot;&gt;</span><br><span class=\"line\">    &lt;/canvas&gt;</span><br><span class=\"line\">    &lt;div class=&quot;video-mark&quot;&gt;</span><br><span class=\"line\">      &lt;!--&gt;插槽可自定义自己的遮罩层 &lt;!--&gt;</span><br><span class=\"line\">      &lt;slot name=&quot;mark&quot;&gt;&lt;/slot&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">import &#123; Toast &#125; from &#x27;vant&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  props: &#123;</span><br><span class=\"line\">    // 设置video 的宽</span><br><span class=\"line\">    videoWidth: &#123;</span><br><span class=\"line\">      type: [ Number, String],</span><br><span class=\"line\">      default: 300</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    // 设置video 的高</span><br><span class=\"line\">    videoHeight: &#123;</span><br><span class=\"line\">      type: [ Number, String],</span><br><span class=\"line\">      default: 300</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  mounted() &#123;</span><br><span class=\"line\">    // 进入页面 自动调用摄像头</span><br><span class=\"line\">    this.initCamera();</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    async initCamera() &#123;</span><br><span class=\"line\">      // 提示</span><br><span class=\"line\">      await this.initToast(&#x27;初始化...&#x27;, 0)</span><br><span class=\"line\">      // 校验兼容性</span><br><span class=\"line\">      await this.checkCompatible()</span><br><span class=\"line\">      // 创建video</span><br><span class=\"line\">      await this.createVideo()</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    // 生成video</span><br><span class=\"line\">    async createVideo() &#123;</span><br><span class=\"line\">      const constraints = &#123;</span><br><span class=\"line\">        audio: false,</span><br><span class=\"line\">        video: &#123;</span><br><span class=\"line\">          width: this.videoWidth,</span><br><span class=\"line\">          height: this.videoHeight,</span><br><span class=\"line\">          facingMode: &quot;user&quot; // 前置优先</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      // 正常支持版本</span><br><span class=\"line\">      navigator.mediaDevices.getUserMedia(constraints).then((stream) =&gt; &#123;</span><br><span class=\"line\">        // 摄像头开启成功</span><br><span class=\"line\">        this.$refs.video.srcObject = stream;</span><br><span class=\"line\">        // ios 需要video load后才可以调用play</span><br><span class=\"line\">        // 调用play 需要延迟处理</span><br><span class=\"line\">        this.$refs.video.load()</span><br><span class=\"line\">        setTimeout(() =&gt; &#123;</span><br><span class=\"line\">          this.$refs.video.play()</span><br><span class=\"line\">          Toast.clear();</span><br><span class=\"line\">        &#125;, 1000);</span><br><span class=\"line\">      &#125;).catch(err =&gt; &#123;</span><br><span class=\"line\">        Toast.clear();</span><br><span class=\"line\">        console.log(&#x27;error===&gt;&#x27;, err);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    // 校验兼容性</span><br><span class=\"line\">    async checkCompatible() &#123;</span><br><span class=\"line\">      // 兼容性判断</span><br><span class=\"line\">      // 旧版本浏览器可能根本不支持mediaDevices,首先设置一个空对象</span><br><span class=\"line\">      if (navigator.mediaCapabilities === undefined) &#123;</span><br><span class=\"line\">        navigator.mediaCapabilities = &#123;&#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      // 一些浏览器实现了部分mediaDevices,不能值分配一个对象</span><br><span class=\"line\">      // 使用getUserMedia属性，就添加她</span><br><span class=\"line\">      if (navigator.mediaDevices.getUserMedia === undefined) &#123;</span><br><span class=\"line\">        // eslint-disable-next-line func-names</span><br><span class=\"line\">        navigator.mediaCapabilities.getUserMedia = function(constraints) &#123;</span><br><span class=\"line\">          // 首先获取现存的getUserMedia(如果存在)</span><br><span class=\"line\">          const getUserMedia =</span><br><span class=\"line\">            navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.getUserMedia;</span><br><span class=\"line\">          // 有些浏览器不支持，会返回错误信息</span><br><span class=\"line\">          // 保持接口一致</span><br><span class=\"line\">          if (!getUserMedia) &#123;</span><br><span class=\"line\">            return Promise.reject(new Error(&quot;浏览器不支持！&quot;));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          // 否则，使用Promise将调用爆炸到旧的navigator.getUserMedia</span><br><span class=\"line\">          return new Promise((resolve, reject) =&gt; &#123;</span><br><span class=\"line\">            getUserMedia.call(navigator, constraints, resolve, reject);</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    // 获取</span><br><span class=\"line\">    getVideoCameraInfo() &#123;</span><br><span class=\"line\">      // 获取 canvas 画布</span><br><span class=\"line\">      const canvas = document.getElementById(&#x27;canvasCamera&#x27;);</span><br><span class=\"line\">      const context = canvas.getContext(&#x27;2d&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">      // 位移来做镜像翻转</span><br><span class=\"line\">      context.translate(this.videoWidth, 0);</span><br><span class=\"line\">      context.scale(-1, 1); // 左右镜像翻转</span><br><span class=\"line\">      context.drawImage(this.$refs.video, 0, 0,  this.videoWidth, this.videoHeight);</span><br><span class=\"line\">      return canvas;</span><br><span class=\"line\">      // const image = canvas.toDataURL(&#x27;image/png&#x27;);</span><br><span class=\"line\">      // return image;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    async initToast(msg, duration = 0) &#123;</span><br><span class=\"line\">      Toast.loading(&#123;</span><br><span class=\"line\">        duration, // 持续展示 toast</span><br><span class=\"line\">        forbidClick: true,</span><br><span class=\"line\">        message: msg,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  beforeDestroy() &#123;</span><br><span class=\"line\">    // 关闭视频</span><br><span class=\"line\">    this.$refs.video.srcObject.getTracks()[0].stop();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class=\"line\">.video-mark &#123;</span><br><span class=\"line\">  width: 100%;</span><br><span class=\"line\">  height: 100%;</span><br><span class=\"line\">  position: fixed;</span><br><span class=\"line\">  top: 0;</span><br><span class=\"line\">  left: 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">video &#123;</span><br><span class=\"line\">  display: block;</span><br><span class=\"line\">  object-fit: fill;</span><br><span class=\"line\">  transform: rotateY(180deg);</span><br><span class=\"line\">  -webkit-transform: rotateY(180deg);    /* Safari 和 Chrome */</span><br><span class=\"line\">  -moz-transform: rotateY(180deg);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"附上压缩文件方法\"><a href=\"#附上压缩文件方法\" class=\"headerlink\" title=\"附上压缩文件方法\"></a>附上压缩文件方法</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>引入 npm run browser-image-compression</p></blockquote>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>import imageCompression from ‘browser-image-compression’</p></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> // 获取图片base64链接</span><br><span class=\"line\"> const options = &#123;</span><br><span class=\"line\">   maxSizeMB: 0.05, //压缩大小 MB</span><br><span class=\"line\">   maxWidthOrHeight: 200, // 压缩尺寸</span><br><span class=\"line\">   useWebWorker: true,</span><br><span class=\"line\">   fileType: &#x27;image/jpeg&#x27; // 文件类型</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const compressedFile = await imageCompression(blob, options);</span><br></pre></td></tr></table></figure>\n","text":"h5页面调用摄像头调用摄像头的几个易难点 本地可以部署后不行 navigator.mediaDevices 调用需要在 localhost,或者https 的环境下才能成功，如果是http的则将报错，无法调用成功。 video 的宽高设置 video组件的宽高比是固定的，直接设置...","link":"","photos":[],"count_time":{"symbolsCount":"5.5k","symbolsTime":"5 mins."},"categories":[{"name":"文章","slug":"文章","count":2,"path":"api/categories/文章.json"}],"tags":[{"name":"技术分享","slug":"技术分享","count":2,"path":"api/tags/技术分享.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#h5%E9%A1%B5%E9%9D%A2%E8%B0%83%E7%94%A8%E6%91%84%E5%83%8F%E5%A4%B4\"><span class=\"toc-text\">h5页面调用摄像头</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E6%91%84%E5%83%8F%E5%A4%B4%E7%9A%84%E5%87%A0%E4%B8%AA%E6%98%93%E9%9A%BE%E7%82%B9\"><span class=\"toc-text\">调用摄像头的几个易难点</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#vue-%E5%B0%81%E8%A3%85%E7%9A%84-h5%E4%B8%AD%E8%B0%83%E7%94%A8%E6%91%84%E5%83%8F%E5%A4%B4%E4%BB%A3%E7%A0%81-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">vue 封装的 h5中调用摄像头代码 使用方法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">代码</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%99%84%E4%B8%8A%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">附上压缩文件方法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">使用方法</span></a></li></ol></li></ol></li></ol>","author":{"name":"虞建辉","slug":"虞建辉","avatar":"https://avatars.githubusercontent.com/u/7228360?s=400&u=5b2242e59ba02c0e1e7bc43eb68b070e26ec6a6e&v=4","link":"/","description":"好的程序员从来不只写代码，他们还致力于优雅地解决问题","socials":{"github":"https://github.com/yujianhui1993?tab=repositories","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"基于van-swipe 进行的定制开发","uid":"7ad521757790024b9bb4160a33768155","slug":"swiper","date":"2023-06-15T10:49:36.000Z","updated":"2023-06-09T01:13:36.594Z","comments":true,"path":"api/articles/swiper.json","keywords":null,"cover":[],"text":"基于van-swipe 进行的定制开发 没改改其实现逻辑，只是对页面样式进行个性化 swiper 的实现逻辑 说白了就是左右移动或者上下移动，利用translateX 或者translateY，固定显示区域，整个内容左右或上下移动。添加一些动画效果即可实现。原理简单为什么不自己开...","link":"","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[{"name":"文章","slug":"文章","count":2,"path":"api/categories/文章.json"}],"tags":[{"name":"技术分享","slug":"技术分享","count":2,"path":"api/tags/技术分享.json"}],"author":{"name":"虞建辉","slug":"虞建辉","avatar":"https://avatars.githubusercontent.com/u/7228360?s=400&u=5b2242e59ba02c0e1e7bc43eb68b070e26ec6a6e&v=4","link":"/","description":"好的程序员从来不只写代码，他们还致力于优雅地解决问题","socials":{"github":"https://github.com/yujianhui1993?tab=repositories","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"search 搜索框","uid":"18db155cdf7884a42c7fab4d4de46a4c","slug":"base-search","date":"2022-10-15T10:49:36.000Z","updated":"2023-06-09T01:13:36.590Z","comments":true,"path":"api/articles/base-search.json","keywords":null,"cover":null,"text":"search 搜索框通用页面搜索使用，支持input slect date, 多条件时支持展开缩放功能 演示案例示例一::: demo 通用页面搜索使用，支持input slect date, 多条件时支持展开缩放功能，只需配置搜索搜索项 12345678910111213141...","link":"","photos":[],"count_time":{"symbolsCount":"4.6k","symbolsTime":"4 mins."},"categories":[{"name":"组件","slug":"组件","count":2,"path":"api/categories/组件.json"}],"tags":[{"name":"组件封装","slug":"组件封装","count":2,"path":"api/tags/组件封装.json"}],"author":{"name":"虞建辉","slug":"虞建辉","avatar":"https://avatars.githubusercontent.com/u/7228360?s=400&u=5b2242e59ba02c0e1e7bc43eb68b070e26ec6a6e&v=4","link":"/","description":"好的程序员从来不只写代码，他们还致力于优雅地解决问题","socials":{"github":"https://github.com/yujianhui1993?tab=repositories","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}